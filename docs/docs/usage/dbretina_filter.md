# Filtering pairwise similarities

The Filter command in DBRetina is designed to filter out the pairwise TSV file. The command requires the **full path** of the pairwise TSV file.

```
Usage: DBRetina filter [OPTIONS]

  Filter a pairwise file.

  Detailed description:

      Filter a pairwise file by similarity cutoff and/or a set of groups
      (provided as a single-column file or cluster IDs in a DBRetina cluster
      file).

Options:
  -p, --pairwise PATH       the pairwise TSV file  [required]
  -g, --groups-file PATH    single-column supergroups file
  --clusters-file PATH      DBRetina clusters file
  --cluster-ids TEXT        comma-separated list of cluster IDs
  -m, --metric TEXT         select from ['containment', 'ochiai', 'jaccard',
                            'pvalue']
  -c, --cutoff FLOAT RANGE  filter out similarities < cutoff  [0<=x<=100]
  --extend                  include all supergroups that are linked to the
                            given supergroups.
  -o, --output TEXT         output file prefix  [required]
  --help                    Show this message and exit.
```

## Command arguments

<span class="cmd"> -p, --pairwise PATH       the pairwise TSV file  [required] </span>

The pairwise file to be filtered. This file can be generated by [`DBRetina pairwise`](dbretina_pairwise.md){:target="_blank"} or `DBretina filter` commands.


<span class="cmd"> -g, --groups-file PATH    single-column supergroups file </span>
The groups file is a single-column file text file that contains the names of the supergroups to be included in the filtering.

!!! note

    **The group names must exist in the [`{index_prefix}_raw.json`](dbretina_index.md#primary-output-files) file. It will be autoconverted to lowercase.**

<span class="cmd"> --clusters-file PATH      DBRetina clusters file </span>

The clusters file is generated from the command [`DBRetina cluster`](dbretina_cluster.md){:target="_blank"}. This is used alongside the `--cluster-ids` argument to filter out all pairwise similarities that are not in the provided clusters.

<span class="cmd"> --cluster-ids TEXT        comma-separated list of cluster IDs </span>

The cluster IDs selected from the clusters file. This argument is only used if the `--clusters-file` is provided.

<span class="cmd"> -m, --metric TEXT      select from ['containment', 'ochiai', 'jaccard', 'pvalue'] </span>

The similarity metric to filter out pairwise comparisons below a certain cutoff.

<span class="cmd"> -c, --cutoff FLOAT RANGE  filter out similarities < cutoff  [default: 0.0; 0<=x<=100] </span>

The `-c --cutoff` argument is used with the `-m --metric` argument to define the cutoff.

<span class="cmd"> --extend                  include all supergroups that are linked to the given supergroups. </span>

In pairwise comparisons, imagine a graph with groups as nodes and their relationships as edges. Initially, only edges between user-defined groups are considered. The `--extend` option enlarges this scope, incorporating all nodes directly linked to user-defined groups, from either the `--groups` input or the `--clusters-file` & `--cluster-ids`. This option can only be used when groups information is provided.


<span class="cmd"> -o, --output TEXT         output file prefix  [required] </span>

The output files prefix.


!!! example "Usage examples"

    === "Similarity cutoff"

        ```bash
          DBRetina filter -p pairwise.tsv -m ochiai -c 60 -o filtered_pairwise
        ```

        This will filter out all pairwise similarities that are below 60% Ochiai similarity.

    === "Similarity cutoff & groups file"

        ```bash
          DBRetina filter -p pairwise.tsv -m containment -c 97 -g groups.tsv -o filtered_pairwise
        ```

        This will filter out all pairwise similarities that are below 97% containment similarity AND exist in the `groups.tsv` file.


    === "Cluster IDs"

        ```bash
        DBRetina filter -p pairwise.tsv --clusters-file clusters.tsv --clusters-ids 1,2,8 -o filtered_pairwise
        ```

        This will filter out all pairwise similarities that are not in the clusters with IDs 1, 2, and 8.

    === "Groups file"

        ```bash
          DBRetina filter -p pairwise.tsv -g groups.tsv -o filtered_pairwise
        ```

        This will filter out all pairwise similarities that are between groups that are not in the `groups.tsv` file. In other words, it will only keep the similarities between groups that are in the `groups.tsv` file.



<!-- I AM HERE -->

<hr class="fancy-hr">


## Output files

<span class="cmd"> {output_prefix}.tsv </span>

Filtered version of the pairwise TSV file.

<span class="cmd"> {output_prefix}_extended_supergroups.txt </span>

If the `--extend` argument is used, this file will contain the names of the extended supergroups.

